class Solution {
    public boolean areSentencesSimilar(String[] words1, String[] words2, String[][] pairs) {
        //Sanity check
        if(words1.length!=words2.length) return false;
        int m = words1.length;
        int n = words2.length;
        Map<String, Set<String>> map = new HashMap();
        for(String[] pair:pairs){
            if(!map.containsKey(pair[0])){
                map.put(pair[0], new HashSet<String>());
            }
            map.get(pair[0]).add(pair[1]);
            if(!map.containsKey(pair[1])){
                map.put(pair[1], new HashSet<String>());
            }
            map.get(pair[1]).add(pair[0]);
        }
        for(int i=0;i<words1.length;i++){
            String key = words1[i];
            String val = words2[i];
            if(key.equals(val)) continue;
            if(!map.containsKey(key)){
                if(!map.containsKey(val)){
                    return false;
                }
                else{
                    if(!map.get(val).contains(key)) return false;
                    else continue;
                }
            }
            else{
                if(!map.get(key).contains(val)) return false;
                else continue;
            }
        }
        return true;
    }
}
